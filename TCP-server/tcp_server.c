/* * Example TCP-Server (Sven Zehl) */#include "contiki.h"#include "contiki-net.h"#include "dev/leds.h"#include <stdio.h>#include <string.h>static struct psock ps; //Protothread Strukturstatic char buffer[100]; //Nachrichtenbufferstatic PT_THREAD(handle_connection(struct psock *p)){  PSOCK_BEGIN(p);  /*Sende Willkommensnachricht*/  PSOCK_SEND_STR(p, "Welcome, your request will be processed...\n");  /*Warte auf Nachricht von Client, \n zeigt Datenende an*/  PSOCK_READTO(p, '\n');  printf("TCP Server received: %s\n",buffer);  /*Sende Antwort an Client*/  PSOCK_SEND_STR(p, "You wrote: ");  PSOCK_SEND(p, buffer, PSOCK_DATALEN(p));  PSOCK_SEND_STR(p, "Good bye!\r\n");           /*Schlie√üe Protosocket*/  PSOCK_CLOSE(p);  /*Beende Protosocket Protothread*/  PSOCK_END(p);}PROCESS(example_psock_server_process, "Example protosocket server");AUTOSTART_PROCESSES(&example_psock_server_process);PROCESS_THREAD(example_psock_server_process, ev, data) {  PROCESS_BEGIN();  tcp_listen(UIP_HTONS(1010)); /*Festlegung des Listening Ports*/  while(1)  {    printf("TCP Server is running\n");    PROCESS_WAIT_EVENT_UNTIL(ev == tcpip_event); /*Warte auf ein Packet*/    if(uip_connected())    {      /*Bei Verbindungsanfrage initialisiere Protosocket*/      PSOCK_INIT(&ps, buffer, sizeof(buffer));            while(!(uip_aborted()||uip_closed()||uip_timedout()))      {         PROCESS_WAIT_EVENT_UNTIL(ev == tcpip_event);         handle_connection(&ps); /*Aufruf der Handler-Funktion*/      }    }  }  PROCESS_END();}